cmake_minimum_required (VERSION 2.8.6)

project (DavaFramework)

set ( CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_CURRENT_LIST_DIR}/../CMake/Modules/" ) 

include ( CMake-common )

set ( FRAMEWORK_DEFINITIONS 
-D_UNICODE 
-DUNICODE 
-D_CRT_SECURE_NO_DEPRECATE 
-D_CRT_SECURE_NO_DEPRECATE
-D_CRT_NON_CONFORMING_SWPRINTFS
-DCURL_STATICLIB
-DDAVA_FMOD
)


set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} -DDAVA_DEBUG")

find_package(ZLIB )
if( ZLIB_FOUND )
    list (APPEND DAVA_THIRD_PARTY_INCLUDES_PATH ${ZLIB_INCLUDE_DIR} )
    list (APPEND LIST_SHARED_LIBRARIES          ${ZLIB_LIBRARY}     )
endif()

if( ANDROID )
    set ( LIBRARY_TYPE SHARED )
    
    file ( GLOB LIB_LIST "${DAVA_THIRD_PARTY_LIBRARIES_PATH}/*" )
    list ( APPEND LIST_SHARED_LIBRARIES ${LIB_LIST}  )

    link_directories( "${DAVA_THIRD_PARTY_LIBRARIES_PATH}" )
    set ( LIST_LIBRARIES
        "libcrypto_android.a"
        "libEGL.so"
        "libGLESv1_CM.so"
        "liblog.so"
        "libandroid.so"
        "-lGLESv2"
        "-lstdc++" )
        
    list ( APPEND LIST_SHARED_LIBRARIES ${LIST_LIBRARIES} )

    set ( FRAMEWORK_DEFINITIONS  ${FRAMEWORK_DEFINITIONS} -D___ANDROID__ -DDAVA_FMOD )        
    set ( LIBRARY_OUTPUT_PATH    ${THIRD_PARTY_LIBRARIES_PATH} )

elseif( ${CMAKE_SYSTEM_NAME} MATCHES "Darwin" )
    
    add_definitions( -D__DAVAENGINE_PTHREAD__ ) 
    set ( LIBRARY_TYPE STATIC )

    file ( GLOB LIB_LIST "${DAVA_THIRD_PARTY_LIBRARIES_PATH}/*.a" )
    list ( APPEND LIST_SHARED_LIBRARIES ${LIB_LIST}  )   

    INCLUDE_DIRECTORIES ( /System/Library/Frameworks )

    FIND_LIBRARY( COCOA_LIBRARY Cocoa)
    FIND_LIBRARY( GLUT_LIBRARY GLUT )
    FIND_LIBRARY( OpenGL_LIBRARY OpenGL )
    FIND_LIBRARY( AppKit_LIBRARY AppKit )
    FIND_LIBRARY( AVFoundation_LIBRARY AVFoundation )
    FIND_LIBRARY( SecurityFramework_LIBRARY Security ) 
    FIND_LIBRARY( QuartzCore_LIBRARY QuartzCore ) 
    FIND_LIBRARY( CoreMedia_LIBRARY CoreMedia ) 
    FIND_LIBRARY( WebKit_LIBRARY WebKit ) 


    SET( LIST_LIBRARIES 
        ${AVFoundation_LIBRARY} 
        ${AppKit_LIBRARY} 
        ${COCOA_LIBRARY} 
        ${GLUT_LIBRARY} 
        ${OpenGL_LIBRARY} 
        ${SecurityFramework_LIBRARY} 
        ${QuartzCore_LIBRARY} 
        ${CoreMedia_LIBRARY}
        ${WebKit_LIBRARY}
        )  

    list ( APPEND LIST_SHARED_LIBRARIES ${LIST_LIBRARIES} )                           

    set_source_files_properties( ${CMAKE_CURRENT_LIST_DIR}/Platform/ThreadPosix.cpp PROPERTIES COMPILE_FLAGS "-x objective-c++" )  

elseif( IOS )  
  
    set ( LIBRARY_TYPE STATIC )
    
    set ( CMAKE_C_FLAGS    "-mno-thumb"  )
    set ( CMAKE_CXX_FLAGS  "-mno-thumb -fvisibility=hidden" )
    set ( LIST_SHARED_LIBRARIES "libcd.lib" )


else()
    set ( LIBRARY_TYPE STATIC ) 
    
    if ( MSVC )
        file ( GLOB LIB_LIST "${DAVA_THIRD_PARTY_LIBRARIES_PATH}/D/*" )
        list ( APPEND LIST_SHARED_LIBRARIES_DEBUG ${LIB_LIST}  )

        file ( GLOB LIB_LIST "${DAVA_THIRD_PARTY_LIBRARIES_PATH}/*" )
        list ( APPEND LIST_SHARED_LIBRARIES_RELEASE ${LIB_LIST}  )

        set  ( LIST_SHARED_LIBRARIES "opengl32.lib" "ws2_32.lib" "winmm.lib" "wldap32.lib" "iphlpapi.lib"  )

        set( CMAKE_CXX_FLAGS_DEBUG   "${CMAKE_CXX_FLAGS_DEBUG} /MTd /MP"  )
        set( CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MT /MP /fp:fast /Zi /GS- /D _SECURE_SCL=0" )
  
    endif()

endif()


# Define source 
define_source_folders  ()
generate_source_groups_project ()

include_directories    (.)
include_directories    ( ${DAVA_INCLUDE_DIR} )
include_directories    ( ${ADD_ENGINE_INCLUDES_DIR} ) 
include_directories    ( ${DAVA_THIRD_PARTY_ROOT_PATH}/include/FCollada )
include_directories    ( ${DAVA_THIRD_PARTY_INCLUDES_PATH} ) 


add_definitions        ( ${FRAMEWORK_DEFINITIONS} )
add_library            ( DavaFramework ${LIBRARY_TYPE} ${PROJECT_SOURCE_FILES} )


target_link_libraries  ( DavaFramework ${LIST_SHARED_LIBRARIES} )  

foreach ( FILE ${LIST_SHARED_LIBRARIES_DEBUG} )
    target_link_libraries  ( DavaFramework debug ${FILE} )
endforeach ()

foreach ( FILE ${LIST_SHARED_LIBRARIES_RELEASE} )
    target_link_libraries  ( DavaFramework optimized ${FILE} )
endforeach ()


#install(
#    TARGETS
#    DavaFramework
#    DESTINATION
#    ${DAVA_THIRD_PARTY_LIBRARIES_PATH} )

#install(
#    DIRECTORY
#    ${CMAKE_CURRENT_SOURCE_DIR}/
#    DESTINATION
#    ${THIRD_PARTY_INCLUDE_PATH}/DavaFramework
#    FILES_MATCHING
#    PATTERN
#    "*.h")
